# SECURING DB FROM PODS FROM DIFFERENET NAMESPACE

![image](https://github.com/pavankumar0077/kubernetes-troubleshooting-zero-to-hero/assets/40380941/33c1fb2c-d163-4a20-a8e8-001d3e194401)


## PROBLEM STATEMENT

- WE HAVE A KUBERNETES CLUSTER, IN THAT WE HAVE 2 NAMESPACES,
- WHERE IN ONE OF THE NS WE HAVE A DB, AND THE REST OF THE PODS ARE ACCESSING IT.
- NOW WE HAVE THE DB FROM THE OTHER PODS TO ACCESS WHICH ARE IN OTHER NAEMSPACES WITHIN THE SAME KUBERNETES CLUSTER.

## REASON
- FOR SOME REASON THE KUBERNETES CLUSTER GOT HACKED, OR PODS IN THE ONE NS ARE HACKED.
- IF WE ARE NOT RESTRICTING THE ACCESS FROM OTHER NS THEN OUR DB WILL BE HACKED.

## SOLUTION
- WE REQUIRED TO RESTRICT OTHER PODS FROM ACCESSING THE DB FROM OTHER NAMESPACE IS SIMPLE BE'COZ **SECURITY**

## HOW TO DO
- WE HAVE A CONCEPT CALLED NETWORK POLICY
- NETWORK POLICY IS DEVIDED INTO 2 CATEGORIES
- 1. INGRESS - IT IS NOTHING BUT WHERE USING NETWORK POLICY WE CAN RESTRICT INWARD TRAFFIC TO THE DATABASE OR ANY PARTICULAR POD
- 2. EGRESS - HERE WE ARE RESTRICT ANY TRAFFIC THAT IS GOING OUT OF THE POD.
- WE CAN RESTRICT THE LIST OF DOMAIN OR IP ADDRESS TO RESTRICT ACCESS TO THAT PODS, LIKE ANY UNSECURE WEBSITE OR PARTICULAR DOMAIN
- WE NEED TO ADD ALL THE DOMAINS WHICH WE WANT TO RESTRICT THE ACCESS FROM THE POD.

## DEMO
- WE WILL CREATE A SIMPLE IN-MEMORY DB REDIS (WE CAN USE ANY DB)
- WITHOUT CREATING NETWORK POLICY, WHICH IS CALLED HACKER POD ABLE TO TALK TO THE DATABASE.
- WHICH IS IN DIFFERENT DATABASE BUT IT IS ABLE TO TALK TO THE DATABASE.
- ONCE WE APPLY NETWORK POLICY THE CONNECTION FROM THE HACKED POD TO DB WILL BE DENY OR RESTRICTED OR BLOCKED.


### TO CREATE A NAMESPACE
``` kubectl create ns secure-namespace ```

### TO DEPLOY ON A PARTICULAR NAMESPACE
``` kubectl apply -f db.yaml -n secure-namespace ```
- Here secure-namespace is name of the namespace.

### TO EXEC INTO RUNNING POD
```  kubectl -n secure-namespace exec -it redis-5496dd9bcb-8wxhs -- /bin/bash ```

### TO CONNECT TO DATABASE
``` redis-cli ```
FOR OTHER DB's
- WE USE mysql-cli for mysql
- mongo cli client for mongo db

### ANOTHER WAY TO GO INTO THE RUNNING POD
``` kubectl exec -it deploy/nginx-deployment -- /bin/bash ```

### INSTALL REDIS-CLI IN THE RUNNING POD BY EXEC INTO THE CONTAINER
``` https://redis.io/docs/latest/operate/oss_and_stack/install/install-redis/install-redis-on-linux/ ```
- FIRST DO apt-get update then follow the docs.

